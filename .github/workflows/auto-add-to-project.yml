name: Auto Add and Sync Project Modules

on:
  push:
    branches:
      - main
  issues:
    types: [opened, reopened]

permissions:
  issues: write
  projects: write
  contents: read

jobs:
  auto-add:
    runs-on: ubuntu-latest
    steps:
      - name: Add new issue to project board
        uses: actions/add-to-project@v0.5.0
        with:
          project-url: https://github.com/users/codemedic1424/projects/7
          github-token: ${{ secrets.GITHUB_TOKEN }}

  sync-pathways:
    runs-on: ubuntu-latest
    if: github.event_name == 'push'
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install GitHub CLI
        run: |
          sudo apt-get update
          sudo apt-get install -y gh
          echo "${{ secrets.GITHUB_TOKEN }}" | gh auth login --with-token

      - name: Create module issues if missing
        run: |
          echo "üß© Checking and creating module issues if needed..."
          for module in "Swift" "SwiftUI" "Develop in Swift"; do
            if ! gh issue list --repo codemedic1424/Develop-in-Swift-2025 --search "$module" --state all --json title | grep -q "$module"; then
              gh issue create \
                --repo codemedic1424/Develop-in-Swift-2025 \
                --title "$module Module Tracker" \
                --body "Auto-created tracking issue for **$module** module progress." \
                --label "Module"
              echo "‚úÖ Created issue for $module"
            else
              echo "‚ÑπÔ∏è Issue already exists for $module"
            fi
          done
